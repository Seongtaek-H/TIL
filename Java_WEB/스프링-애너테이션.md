## 스프링-애너테이션

#### 스프링 애너테이션 제공 클래스

| 클래스                          | 기능                                 |
| ------------------------------- | ------------------------------------ |
| DefaultAnnotationHandlerMapping | 클래스 레벨에서 @RequestMapping 처리 |
| AnnotationMethodHandlerAdapter  | 메서드 레벨에서 @RequestMapping 처리 |



#### `<context:component-scan>` 태그 기능

> 패키지 이름을 지정하면 애플리케이션 실행시 해당 패키지에서 애너테이션으로 지정된 클래스를 bean으로 만들어줌

**`지정한 패키지에 위치하는 클래스에서 지정하는 애너테이션`**

| 애너테이션  | 기능                                                         |
| ----------- | ------------------------------------------------------------ |
| @Controller | 스프링 컨테이너가 component-scan에 의해 지정한 클래스를 컨트롤러 빈으로 자동 변환 |
| @Service    | 스프링 컨테이너가 component-scan에 의해 지정한 클래스를 서비스 빈으로 자동 변환 |
| @Repository | 스프링 컨테이너가 component-scan에 의해 지정한 클래스를 DAO 빈으로 자동 변환 |
| @Component  | 스프링 컨테이너가 component-scan에 의해 지정한 클래스를 빈으로 자동 변환 |



* action-servlet : 스프링에서 제공하는 DefaultAnnotationHandlerMapping, AnnotationMethodHandlerAdapter 클래스의 빈 설정

```xml
<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
...">

   <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
      <property name="prefix" value="/WEB-INF/views/test/" />
    <!--   <property name="prefix" value="/WEB-INF/views/member/" /> -->
      <property name="suffix" value=".jsp"/>
   </bean>

	<!-- 클래스 레벨에 @RequestMapping 처리 -->
  <bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping"/>
  	<!-- 메서드 레벨에 @RequestMapping 처리 -->
  <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"/>
  	<!-- com.spring 하위 패키지에 존재하는 클래스에 애너테이션이 적용되도록 설정 -->
  <context:component-scan base-package="com.spring"/>
</beans>
```

* MainController : 애너테이션을 이용해 Controller 클래스 및 메서드 요청

```java
// 애너테이션이 적용되려면 반드시 <context:component=scan 하위 패키지에 존재해야함
package com.spring.ex01;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.ModelAndView;

// @Controller 애너테이션을 이용해 MainController 클래스를 빈으로 자동변환. 빈 id는 mainController
@Controller("mainController")
// @RequestMapping 애너테이션을 이용해 URL 요청이 /test 이면 mainController 빈 요청
@RequestMapping("/test")
public class MainController {
	// @RequestMapping 애너테이션을 이용해 두번째 단계 URL 요청이 /main1.do 이면 main1 메서드 요청
   @RequestMapping(value="/main1.do" ,method=RequestMethod.GET)
   public ModelAndView main1(HttpServletRequest request, HttpServletResponse response)  throws Exception{
      ModelAndView mav=new ModelAndView();
      mav.addObject("msg","main1");
      mav.setViewName("main");
      return mav;
   }
   
   // @RequestMapping 애너테이션을 이용해 두번째 단계 URL 요청이 /main2.do 이면 main2 메서드 요청
   @RequestMapping(value="/main2.do" ,method = RequestMethod.GET)
   public ModelAndView main2(HttpServletRequest request, HttpServletResponse response) throws Exception{
      ModelAndView mav=new ModelAndView();
      mav.addObject("msg","main2");
      mav.setViewName("main");
      return mav;
   }
}
```

* main.jsp : 컨트롤러에서 ModelAndView에 뷰이름으로 설정한 jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" 
    isELIgnored="false"  %>
 <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"  %>

<%
  request.setCharacterEncoding("UTF-8");
%>    

<html>
<head>
<meta charset=UTF-8">
<title>결과창</title>
</head>
<body>
<h1>안녕하세요!!</h1>
<h1>${msg} 페이지입니다!!</h1> <!-- 컨트롤러에서 addObject로 넘긴 메세지 호출 -->
</body>
</html>
```



#### 로그인 기능 구현

* LoginController 클래스

```java
package com.spring.ex02;

import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

//컨트롤러 빈 자동으로 생성
@Controller("loginController")
public class LoginController {
	// /test/loginForm.do, /test/loginForm2.do 로 요청시 loginForm 메서드 호출
	@RequestMapping(value = { "/test/loginForm.do", "/test/loginForm2.do" }, method = { RequestMethod.GET })
	public ModelAndView loginForm(HttpServletRequest request, HttpServletResponse response) throws Exception {
		ModelAndView mav = new ModelAndView();
		mav.setViewName("loginForm");
		return mav;
	}
	
	// get, post 모두 처리
    @RequestMapping(value = "/test/login.do", method={RequestMethod.GET,RequestMethod.POST})
	public ModelAndView login(HttpServletRequest request, HttpServletResponse response) throws Exception {
		request.setCharacterEncoding("utf-8");
		ModelAndView mav = new ModelAndView();
		mav.setViewName("result");
		String userID = request.getParameter("userID");
		String userName = request.getParameter("userName");
		mav.addObject("userID", userID);
		mav.addObject("userName", userName);
		return mav;
	}
}
```

* loginForm.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" 
    isELIgnored="false"  %>
 <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"  %>

<!-- contextPath를 현재 경로로 설정 -->
<c:set var="contextPath"  value="${pageContext.request.contextPath}"/>
<%
  request.setCharacterEncoding("UTF-8");
%>    

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>로그인창</title>
</head>

<body>
    <!-- 로그인 클릭 시 /test/login.do 로 요청 -->
<form   method="post"  action="${contextPath}/test/login.do">
	<table width="400">
		<tr>
			<td>아이디 <input type="text" name="userID" size="10"></td>
		</tr>
		<tr>
			<td>이름 <input type="text" name="userName" size="10"></td>
		</tr>
	    <tr>
			<td>
			  <input type="submit" value="로그인">
			  <input type="reset" value="다시입력">
			</td>
		</tr>
	</table>
</form>
</body>
</html>
```

* result.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" 
    isELIgnored="false"  %>
 <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"  %>

<%
  request.setCharacterEncoding("UTF-8");
%>    

<html>
<head>
<meta charset=UTF-8">
<title>결과창</title>
</head>
<body>
<h1>아이디 : ${userID }</h1>
<h1>이름   : ${userName }</h1>
</body>
</html>
```

